# Nome do nosso "trabalho"
name: Rodar Scraper de Vagas

on:
  # 1. Permite que você rode manualmente pela aba "Actions" do GitHub
  workflow_dispatch:

  # 2. Agenda a execução automática
  schedule:
    # Roda "às 00:00, 04:00, 08:00, 12:00, 16:00, 20:00 UTC" (a cada 4 horas)
    - cron: '0 */4 * * *' 

jobs:
  scrape:
    # Diz ao GitHub para usar uma máquina virtual Linux (Ubuntu)
    runs-on: ubuntu-latest

    steps:
      # Passo 1: Baixar o código do seu repositório
      - name: 1. Baixar o código (Checkout)
        uses: actions/checkout@v4

      # Passo 2: Configurar o ambiente Node.js
      - name: 2. Configurar o Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20 # Usar a versão 20 (LTS)

      # Passo 3: Instalar as dependências do projeto (Express, Mongo, Playwright)
      - name: 3. Instalar dependências (npm install)
        run: npm install

      # Passo 4: Instalar os navegadores do Playwright na máquina do GitHub
      - name: 4. Instalar navegadores do Playwright
        run: npx playwright install

      # Passo 5: Rodar o Robô Scraper!
      - name: 5. Executar o Robô Scraper
        env:
          # "Conecta" o Secret do GitHub com o código (process.env.MONGODB_URI)
          MONGODB_URI: ${{ secrets.MONGODB_URI }}
        run: node scraper.js